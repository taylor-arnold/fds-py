<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Taylor Arnold">

<title>17&nbsp; Temporal Data – Foundations of Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./18_network_data.html" rel="next">
<link href="./16_spatial_data.html" rel="prev">
<link href="./img/owl_explore.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-25064e4154141e7ea34817c6f1220590.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./16_spatial_data.html">Part IV: Applications</a></li><li class="breadcrumb-item"><a href="./17_temporal_data.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Temporal Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Foundations of Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/taylor-arnold/fds-py" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Part I: Core</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_modify.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">EDA I: Organizing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">EDA II: Visualizing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_combine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">EDA III: Restructuring Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_collect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">EDA IV: Collecting Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Part II: Programming</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_dataformats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Formats</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_requests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Requests</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Part III: Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_supervised.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Supervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_unsupervised.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Unsupervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_deeplearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Deep Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_cnnwordvec.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">CNNs and Word2Vec</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_transferlearn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Transfer Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_spatial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_temporal_data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Temporal Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_network_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Network Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_textual_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Textual Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_image_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Image Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Part V: Notes</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Notes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Datasets</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup"><span class="header-section-number">17.1</span> Setup</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">17.2</span> Introduction</a></li>
  <li><a href="#temporal-data-and-ordering" id="toc-temporal-data-and-ordering" class="nav-link" data-scroll-target="#temporal-data-and-ordering"><span class="header-section-number">17.3</span> Temporal Data and Ordering</a></li>
  <li><a href="#date-objects" id="toc-date-objects" class="nav-link" data-scroll-target="#date-objects"><span class="header-section-number">17.4</span> Date Objects</a></li>
  <li><a href="#datetime-objects" id="toc-datetime-objects" class="nav-link" data-scroll-target="#datetime-objects"><span class="header-section-number">17.5</span> Datetime Objects</a></li>
  <li><a href="#language-and-time-zones" id="toc-language-and-time-zones" class="nav-link" data-scroll-target="#language-and-time-zones"><span class="header-section-number">17.6</span> Language and Time Zones</a></li>
  <li><a href="#truncating-dates-data" id="toc-truncating-dates-data" class="nav-link" data-scroll-target="#truncating-dates-data"><span class="header-section-number">17.7</span> Truncating Dates Data</a></li>
  <li><a href="#window-functions" id="toc-window-functions" class="nav-link" data-scroll-target="#window-functions"><span class="header-section-number">17.8</span> Window Functions</a></li>
  <li><a href="#range-joins" id="toc-range-joins" class="nav-link" data-scroll-target="#range-joins"><span class="header-section-number">17.9</span> Range Joins</a></li>
  <li><a href="#temporal-durations" id="toc-temporal-durations" class="nav-link" data-scroll-target="#temporal-durations"><span class="header-section-number">17.10</span> Temporal Durations</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">17.11</span> Summary</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./16_spatial_data.html">Part IV: Applications</a></li><li class="breadcrumb-item"><a href="./17_temporal_data.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Temporal Data</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-temporal" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Temporal Data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice Notebooks
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Notebook17a [<a href="https://colab.research.google.com/github/taylor-arnold/fds-py-nb/blob/main/nb/notebook17a.ipynb?hl=en">Colab↗</a>]</li>
<li>Notebook17b [<a href="https://colab.research.google.com/github/taylor-arnold/fds-py-nb/blob/main/nb/notebook17b.ipynb?hl=en">Colab↗</a>]</li>
</ul>
</div>
</div>
</div>
<section id="setup" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="setup"><span class="header-section-number">17.1</span> Setup</h2>
<p>Load all of the modules and datasets needed for the chapter.</p>
<div id="da9c225e" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> funs <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> polars <span class="im">import</span> col <span class="im">as</span> c</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>theme_set(theme_minimal())</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>meta <span class="op">=</span> pl.read_csv(<span class="st">"data/wiki_uk_meta.csv.gz"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>page_views <span class="op">=</span> pl.read_csv(<span class="st">"data/wiki_uk_page_views.csv"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>page_revisions <span class="op">=</span> pl.read_csv(<span class="st">"data/wiki_uk_page_revisions.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduction" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">17.2</span> Introduction</h2>
<p>In this chapter, we discuss techniques for working with data that has some temporal component. This includes any kind of data that has one or more variables that record dates or times, as well as any dataset that has a meaningful ordering of its rows. For example, the annotation object that we created for textual data in <a href="19_textual_data.html" class="quarto-xref"><span>Chapter 19</span></a> has a meaningful ordering and can be treated as having a temporal ordering even if it is not associated with fixed timestamps. We will start by focusing specifically on datasets that contain explicit information about dates and times. In the later sections, we will illustrate window functions and range joins, both of which have a wider set of applications to all ordered datasets.</p>
<p>As we saw in <a href="04_combine.html" class="quarto-xref"><span>Chapter 4</span></a>, it is possible to store information about dates and times in a tabular dataset. There are many different formats for storing this information; we recommend that most users start by recording these with separate columns for each numeric component of the date or time. This makes it easier to avoid errors and to record partial information, the latter being a common complication of many humanities datasets. We will begin by looking at a dataset related to the Wikipedia pages we saw in the previous two chapters that has date information stored in such a format.</p>
<p>In showing the application of line graphs in <a href="03_graphics.html" class="quarto-xref"><span>Chapter 3</span></a>, we saw how to visualize a dataset of food prices over a 140-year period. This visualization was fairly straightforward. There was exactly one row for each year. We were able to treat the year variable as any other continuous measurement, with the only change being that it made sense to connect dots with a line when building the visualization. Here we will work with a slightly more complex example corresponding to the Wikipedia pages from the preceding chapters.</p>
</section>
<section id="temporal-data-and-ordering" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="temporal-data-and-ordering"><span class="header-section-number">17.3</span> Temporal Data and Ordering</h2>
<p>Let’s start by loading some data with a temporal component. Below, we read in data related to the 75 Wikipedia pages from a selection of British authors. Here, we have a different set of information about the pages than we used in the text and network analysis chapters. For each page, we have grabbed page view statistics for a 60-day period from Wikipedia. In other words, we have a record of how many people looked at a particular page each day, for each author. The data are organized with one row for each combination of item and day.</p>
<div id="59ea84de" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>page_views</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4_490, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">views</th>
</tr>
<tr class="even">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Marie de France"</td>
<td>2023</td>
<td>8</td>
<td>1</td>
<td>121</td>
</tr>
<tr class="even">
<td>"Marie de France"</td>
<td>2023</td>
<td>8</td>
<td>2</td>
<td>138</td>
</tr>
<tr class="odd">
<td>"Marie de France"</td>
<td>2023</td>
<td>8</td>
<td>3</td>
<td>138</td>
</tr>
<tr class="even">
<td>"Marie de France"</td>
<td>2023</td>
<td>8</td>
<td>4</td>
<td>129</td>
</tr>
<tr class="odd">
<td>"Marie de France"</td>
<td>2023</td>
<td>8</td>
<td>5</td>
<td>104</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Seamus Heaney"</td>
<td>2023</td>
<td>9</td>
<td>25</td>
<td>719</td>
</tr>
<tr class="even">
<td>"Seamus Heaney"</td>
<td>2023</td>
<td>9</td>
<td>26</td>
<td>802</td>
</tr>
<tr class="odd">
<td>"Seamus Heaney"</td>
<td>2023</td>
<td>9</td>
<td>27</td>
<td>694</td>
</tr>
<tr class="even">
<td>"Seamus Heaney"</td>
<td>2023</td>
<td>9</td>
<td>28</td>
<td>655</td>
</tr>
<tr class="odd">
<td>"Seamus Heaney"</td>
<td>2023</td>
<td>9</td>
<td>29</td>
<td>719</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The time variables are given the way we recommended in <a href="04_combine.html" class="quarto-xref"><span>Chapter 4</span></a>, with individual columns for year, month, and day. Here, our dataset is already ordered (within each item type) from the earliest records to the latest. If this were not the case, because all of our variables are stored as numbers, we could use the <code>.sort()</code> method to sort by year, followed by month, followed by day, to get the same ordering.</p>
<p>How could we show the change in page views over time for a particular variable? One approach is to add a numeric column running down the dataset using a row number. Below is an example of the code to create a line plot using this approach:</p>
<div id="cc22d0c8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    page_views</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.doc_id <span class="op">==</span> <span class="st">"Geoffrey Chaucer"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    .with_row_index(<span class="st">"row_number"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"row_number"</span>, <span class="st">"views"</span>))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_line(color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Page Views for Geoffrey Chaucer (by Day Number)"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"Day Number"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Views"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<figure class="figure">
<p><a href="17_temporal_data_files/figure-html/cell-5-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="17_temporal_data_files/figure-html/cell-5-output-1.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>In this case, our starting plot is not a bad place to begin. The x-axis corresponds to the day number, and in many applications that may be exactly what we need. We can clearly see that the number of page views for Chaucer has a relatively stable count, possibly with some periodic swings over the course of the week. There is one day about two-thirds of the way through the plot in which the count spikes. Notice, though, that it is very hard to tell anything from the plot about exactly what days of the year are being represented. We cannot easily see which day has the spike in views, for example. Also, note that the correspondence between the row number and day only works because the data are uniformly sampled (one observation each day) and there is no missing data.</p>
<p>Another way to work with dates is to convert the data to a fractional year format. Here, the months and days are added to form a fractional day. A quick way to do this is to compute the following fractional year:</p>
<p><span class="math display">\[ year_{frac} = year + \frac{month - 1}{12} + \frac{day - 1}{12 \cdot 31}\]</span></p>
<p>We are subtracting one from the month and day so, for example, on a date such as 1 July 2020 (halfway through the year) we have the fractional year equal to <code>2020.5</code>. We could make this even more exact by accounting for the fact that some months have fewer than 31 days, but as a first pass this works relatively well.</p>
<div id="80f04e69" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    page_views</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.doc_id <span class="op">==</span> <span class="st">"Geoffrey Chaucer"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        year_frac <span class="op">=</span> c.year <span class="op">+</span> (c.month <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">12</span> <span class="op">+</span> (c.day <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (<span class="dv">12</span> <span class="op">*</span> <span class="dv">31</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"year_frac"</span>, <span class="st">"views"</span>))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_line(color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Page Views for Geoffrey Chaucer (Fractional Year)"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"Fractional Year"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Views"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<figure class="figure">
<p><a href="17_temporal_data_files/figure-html/cell-6-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="17_temporal_data_files/figure-html/cell-6-output-1.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>This revised visualization improves on several aspects of the original plot. For one thing, we can roughly see exactly what dates correspond to each data point. Also, the code will work fine regardless of whether the data are sorted, evenly distributed, or contain any missing values. As a downside, the axis labels take some explaining. We can extend the same approach to working with time data. For example, if we also had the (24-hour) time of our data points the formula would become:</p>
<p><span class="math display">\[ year_{frac} = year + \frac{month - 1}{12} + \frac{day - 1}{12 \cdot 31} + \frac{hour - 1}{24 \cdot 12 \cdot 31}\]</span></p>
<p>If we are only interested in the time since a specific event, say the start of an experiment, we can use the same approach but take the difference relative to a specific fractional year.</p>
<p>Fractional times have a number of important applications. Fractional times are convenient because they can represent an arbitrarily precise date or date-time with an ordinary number. This means that they can be used in other models and applications without any special treatment. They may require different model assumptions, but at least the code should work with minimal effort. This is a great way to explore our data. However, particularly when we want to create nice publishable visualizations, it can be useful to work with specific functions for manipulating dates and times.</p>
</section>
<section id="date-objects" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="date-objects"><span class="header-section-number">17.4</span> Date Objects</h2>
<p>Most of the variables that we have worked with so far are either strings or numbers. Dates are in some ways like numbers: they have a natural ordering, we can talk about the difference between two numbers, and it makes sense to color and plot them on a continuous scale. However, they do have some unique properties, particularly when we want to extract information such as the day of the week from a date, that require a unique data type. To create a date object in Polars, we can use the <code>pl.date()</code> function to construct a date from its components.</p>
<div id="12007494" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>chaucer_with_dates <span class="op">=</span> (</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    page_views</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.doc_id <span class="op">==</span> <span class="st">"Geoffrey Chaucer"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        date <span class="op">=</span> pl.date(c.year, c.month, c.day)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>chaucer_with_dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (60, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">views</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="even">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>1</td>
<td>2133</td>
<td>2023-08-01</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>2</td>
<td>1977</td>
<td>2023-08-02</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>3</td>
<td>1860</td>
<td>2023-08-03</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>4</td>
<td>1739</td>
<td>2023-08-04</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>5</td>
<td>1849</td>
<td>2023-08-05</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>25</td>
<td>2384</td>
<td>2023-09-25</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>26</td>
<td>2188</td>
<td>2023-09-26</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>27</td>
<td>1950</td>
<td>2023-09-27</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>28</td>
<td>2590</td>
<td>2023-09-28</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>29</td>
<td>2082</td>
<td>2023-09-29</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Notice that the new column has the special data type <code>Date</code>. If we build a visualization using a date object, plotnine is able to make helpful built-in choices about how to label the axis. For example, the following code will make a line plot that has nicely labeled values on the x-axis.</p>
<div id="722746c6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    chaucer_with_dates</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"date"</span>, <span class="st">"views"</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_line(color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Page Views for Geoffrey Chaucer"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"Date"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Views"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>
<figure class="figure">
<p><a href="17_temporal_data_files/figure-html/cell-8-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="17_temporal_data_files/figure-html/cell-8-output-1.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>The output shows that the algorithm decided to label the dates appropriately. We can manually change the frequency of the labels using <code>scale_x_date()</code> and setting the <code>date_breaks</code> option. For example, the code below will display one label for each week:</p>
<div id="6edc758c" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    chaucer_with_dates</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"date"</span>, <span class="st">"views"</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_line(color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_x_date(date_breaks<span class="op">=</span><span class="st">"1 week"</span>, date_labels<span class="op">=</span><span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">45</span>, hjust<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Page Views for Geoffrey Chaucer (Weekly Labels)"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"Date"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Views"</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<figure class="figure">
<p><a href="17_temporal_data_files/figure-html/cell-9-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="17_temporal_data_files/figure-html/cell-9-output-1.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Once we have a date object, we can also extract useful information from it. For example, we can extract the weekday of the date using the <code>.dt</code> namespace in Polars. Here, we will compute the weekday and then calculate the average number of page views for each day of the week:</p>
<div id="3e3cd8e1" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    chaucer_with_dates</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        weekday <span class="op">=</span> c.date.dt.weekday()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    .group_by(c.weekday)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        views_avg <span class="op">=</span> c.views.mean()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    .sort(c.views_avg, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">weekday</th>
<th data-quarto-table-cell-role="th">views_avg</th>
</tr>
<tr class="even">
<th>i8</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2273.111111</td>
</tr>
<tr class="even">
<td>4</td>
<td>2098.555556</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1988.111111</td>
</tr>
<tr class="even">
<td>1</td>
<td>1975.75</td>
</tr>
<tr class="odd">
<td>7</td>
<td>1865.5</td>
</tr>
<tr class="even">
<td>5</td>
<td>1828.222222</td>
</tr>
<tr class="odd">
<td>6</td>
<td>1762.375</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here we see the average number of page views by day of the week, where Monday is 1 and Sunday is 7. We can also use the date objects to filter the dataset. For example, we can filter the dataset to only include those dates after 15 January 2020, about two-thirds of the way through our dataset:</p>
<div id="a80ae05b" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    chaucer_with_dates</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.date <span class="op">&gt;</span> pl.date(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">15</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (60, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">views</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="even">
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>1</td>
<td>2133</td>
<td>2023-08-01</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>2</td>
<td>1977</td>
<td>2023-08-02</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>3</td>
<td>1860</td>
<td>2023-08-03</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>4</td>
<td>1739</td>
<td>2023-08-04</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>8</td>
<td>5</td>
<td>1849</td>
<td>2023-08-05</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>25</td>
<td>2384</td>
<td>2023-09-25</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>26</td>
<td>2188</td>
<td>2023-09-26</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>27</td>
<td>1950</td>
<td>2023-09-27</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>28</td>
<td>2590</td>
<td>2023-09-28</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>2023</td>
<td>9</td>
<td>29</td>
<td>2082</td>
<td>2023-09-29</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that we use the <code>pl.date()</code> function to create a date literal for comparison. Polars will also accept string representations of dates in ISO format for filtering.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Extracting date components
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Polars provides many methods in the <code>.dt</code> namespace for extracting components from date and datetime objects. Common examples include <code>.dt.year()</code>, <code>.dt.month()</code>, <code>.dt.day()</code>, <code>.dt.weekday()</code>, <code>.dt.ordinal_day()</code> (day of year), and <code>.dt.quarter()</code>. These are useful for creating features for analysis or for grouping data by time periods.</p>
</div>
</div>
</div>
</section>
<section id="datetime-objects" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="datetime-objects"><span class="header-section-number">17.5</span> Datetime Objects</h2>
<p>The <code>page_views</code> dataset records the date of each observation. Sometimes we have data that describes the time of an event more specifically in terms of hours, minutes, and even possibly seconds. We will use the term <em>datetime</em> to describe an object that stores the precise time that an event occurs. The idea is that to describe the time that something happens we need to specify a date and a time. Later in the chapter, we will see an object that stores time without reference to a particular day. Whereas dates have a natural precision (a single day), we might desire to work with datetime objects of different levels of granularity. In some cases we might have just hours of the day and in others we might have access to records at the level of a millisecond such as data from radio and TV. In Polars, datetime objects are stored with microsecond precision by default, but we can regard the precision as whatever granularity we have given in our data for all practical purposes.</p>
<p>Datetime objects largely function the same as date objects. Let’s grab another dataset from Wikipedia that has precise timestamps. Below, we read in a dataset consisting of the last 500 edits made to each of the 75 British author pages in our collection.</p>
<div id="7800ae6d" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>page_revisions <span class="op">=</span> (</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        datetime <span class="op">=</span> c.datetime.<span class="bu">str</span>.to_datetime(time_zone<span class="op">=</span><span class="st">"UTC"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>page_revisions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (35_470, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">comment</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>datetime[μs, UTC]</th>
<th>i64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Marie de France"</td>
<td>"YurikBot"</td>
<td>2006-07-06 23:24:54 UTC</td>
<td>3061</td>
<td>"robot&nbsp;&nbsp;Adding: [[it:Maria di F…</td>
</tr>
<tr class="even">
<td>"Marie de France"</td>
<td>"YurikBot"</td>
<td>2006-07-24 18:39:08 UTC</td>
<td>3085</td>
<td>"robot&nbsp;&nbsp;Adding: [[pt:Maria de F…</td>
</tr>
<tr class="odd">
<td>"Marie de France"</td>
<td>"Ccarroll"</td>
<td>2006-09-10 13:36:44 UTC</td>
<td>3085</td>
<td>null</td>
</tr>
<tr class="even">
<td>"Marie de France"</td>
<td>"63.231.20.88"</td>
<td>2006-09-18 04:59:53 UTC</td>
<td>3105</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"Marie de France"</td>
<td>"ExplicitImplicity"</td>
<td>2006-09-23 22:27:20 UTC</td>
<td>3104</td>
<td>"i believe it is stupid to tran…</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Seamus Heaney"</td>
<td>"InternetArchiveBot"</td>
<td>2023-09-21 04:51:45 UTC</td>
<td>85491</td>
<td>"Rescuing 1 sources and tagging…</td>
</tr>
<tr class="even">
<td>"Seamus Heaney"</td>
<td>"81.110.56.233"</td>
<td>2023-09-24 12:10:49 UTC</td>
<td>85493</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"Seamus Heaney"</td>
<td>"149.50.162.177"</td>
<td>2023-09-25 16:06:01 UTC</td>
<td>85482</td>
<td>"/* Death */"</td>
</tr>
<tr class="even">
<td>"Seamus Heaney"</td>
<td>"--WikiUser1234945--"</td>
<td>2023-09-25 16:06:11 UTC</td>
<td>85493</td>
<td>"Reverted edits by [[Special:Co…</td>
</tr>
<tr class="odd">
<td>"Seamus Heaney"</td>
<td>"BD2412"</td>
<td>2023-09-27 02:39:46 UTC</td>
<td>85493</td>
<td>"/* 1957–1969 */Clean up spacin…</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Notice that each row has a record in the column <code>datetime</code> that provides a precise datetime object giving the second at which the page was modified. The data were stored using the ISO-8601 format (“YYYY-MM-DD HH:MM:SS”), which Polars can automatically parse with the <code>.str.to_datetime()</code> method.</p>
<p>Our <code>page_revisions</code> dataset includes several pieces of information about each of the edits. We have a username for the person who made the edit (recall that anyone can edit a Wikipedia page), the size in bytes of the page after the edit was made, and a short comment describing what was done in the change. Looking at the page size over time shows when large additions and deletions were made to each record. The code below yields a temporal visualization:</p>
<div id="772dcf61" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>selected_authors <span class="op">=</span> [<span class="st">"Geoffrey Chaucer"</span>, <span class="st">"Emily Brontë"</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.doc_id.is_in(selected_authors))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"datetime"</span>, <span class="st">"size"</span>, color<span class="op">=</span><span class="st">"doc_id"</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_line()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_color_manual(values<span class="op">=</span>[<span class="st">"red"</span>, <span class="st">"blue"</span>])</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Wikipedia Page Size Over Time"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"Date"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Page Size (bytes)"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"Author"</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<figure class="figure">
<p><a href="17_temporal_data_files/figure-html/cell-13-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="17_temporal_data_files/figure-html/cell-13-output-1.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Looking at the plot, we can see that there are a few very large edits (both deletions and additions), likely consisting of large sections added and subtracted from the page. If we want to visualize when these large changes occurred, it would be useful to include a more granular set of labels on the x-axis. We can do this using <code>scale_x_datetime()</code> with custom formatting:</p>
<div id="511ff11d" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.doc_id.is_in(selected_authors))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"datetime"</span>, <span class="st">"size"</span>, color<span class="op">=</span><span class="st">"doc_id"</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_line()</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_color_manual(values<span class="op">=</span>[<span class="st">"red"</span>, <span class="st">"blue"</span>])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_x_datetime(date_breaks<span class="op">=</span><span class="st">"6 months"</span>, date_labels<span class="op">=</span><span class="st">"%b %Y"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>, hjust<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Wikipedia Page Size Over Time (Custom Labels)"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"Date"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Page Size (bytes)"</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"Author"</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>
<figure class="figure">
<p><a href="17_temporal_data_files/figure-html/cell-14-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="17_temporal_data_files/figure-html/cell-14-output-1.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>We can also filter our dataset by a particular range of dates or times. This is useful to zoom into a specific region of our data to investigate patterns that may be otherwise lost. For example, if we wanted to see all of the page sizes for two authors from 2021 onward:</p>
<div id="d6a2e699" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.doc_id.is_in(selected_authors))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.datetime <span class="op">&gt;</span> pl.datetime(<span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">1</span>, time_zone<span class="op">=</span><span class="st">"UTC"</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (506, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">comment</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>datetime[μs, UTC]</th>
<th>i64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>"86.31.15.58"</td>
<td>2021-01-18 09:42:33 UTC</td>
<td>68291</td>
<td>"/* Origin */"</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>"86.31.15.58"</td>
<td>2021-01-18 09:43:16 UTC</td>
<td>68288</td>
<td>"/* Taco Bell */"</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>"88.108.207.22"</td>
<td>2021-01-18 11:15:33 UTC</td>
<td>68284</td>
<td>"/* Career */"</td>
</tr>
<tr class="even">
<td>"Geoffrey Chaucer"</td>
<td>"Pahunkat"</td>
<td>2021-01-18 11:16:09 UTC</td>
<td>68288</td>
<td>"Rollback edit(s) by [[Special:…</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>"88.108.207.22"</td>
<td>2021-01-18 11:16:40 UTC</td>
<td>68293</td>
<td>"/* Origin */"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Emily Brontë"</td>
<td>"HeyElliott"</td>
<td>2023-09-16 20:05:37 UTC</td>
<td>41598</td>
<td>"[[WP:LQ]]"</td>
</tr>
<tr class="even">
<td>"Emily Brontë"</td>
<td>"Qwerfjkl (bot)"</td>
<td>2023-09-21 16:34:46 UTC</td>
<td>41586</td>
<td>"Converting Gutenberg author ID…</td>
</tr>
<tr class="odd">
<td>"Emily Brontë"</td>
<td>"Ficaia"</td>
<td>2023-09-27 12:47:22 UTC</td>
<td>41717</td>
<td>null</td>
</tr>
<tr class="even">
<td>"Emily Brontë"</td>
<td>"Keith D"</td>
<td>2023-09-27 20:36:18 UTC</td>
<td>41688</td>
<td>"Remove namespace | Replaced cu…</td>
</tr>
<tr class="odd">
<td>"Emily Brontë"</td>
<td>"Keith D"</td>
<td>2023-09-27 20:39:51 UTC</td>
<td>41693</td>
<td>"/* Adulthood */ Cite fix"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Notice that the filter includes data from 2021, even though we use a strictly greater than condition. The reason for this is that <code>pl.datetime(2021, 1, 1)</code> is interpreted as the exact time corresponding to 1 January 2021 at 00:00. Any record that comes at any other time during the year of 2021 will be included in the filter.</p>
</section>
<section id="language-and-time-zones" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="language-and-time-zones"><span class="header-section-number">17.6</span> Language and Time Zones</h2>
<p>So far, we have primarily worked with numeric summaries of the date and datetime objects. In the previous sections, notice that our example of working with the days of the week used numeric values (1-7) rather than names. Polars provides methods to extract string names for weekdays and months, though the output depends on your system locale. Below, for example, we extract various datetime components:</p>
<div id="43f95195" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">10</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        weekday_num <span class="op">=</span> c.datetime.dt.weekday(),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        month_num <span class="op">=</span> c.datetime.dt.month(),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        hour <span class="op">=</span> c.datetime.dt.hour(),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        date_only <span class="op">=</span> c.datetime.dt.date()</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    .select(c.datetime, c.weekday_num, c.month_num, c.hour, c.date_only)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">weekday_num</th>
<th data-quarto-table-cell-role="th">month_num</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">date_only</th>
</tr>
<tr class="even">
<th>datetime[μs, UTC]</th>
<th>i8</th>
<th>i8</th>
<th>i8</th>
<th>date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2006-07-06 23:24:54 UTC</td>
<td>4</td>
<td>7</td>
<td>23</td>
<td>2006-07-06</td>
</tr>
<tr class="even">
<td>2006-07-24 18:39:08 UTC</td>
<td>1</td>
<td>7</td>
<td>18</td>
<td>2006-07-24</td>
</tr>
<tr class="odd">
<td>2006-09-10 13:36:44 UTC</td>
<td>7</td>
<td>9</td>
<td>13</td>
<td>2006-09-10</td>
</tr>
<tr class="even">
<td>2006-09-18 04:59:53 UTC</td>
<td>1</td>
<td>9</td>
<td>4</td>
<td>2006-09-18</td>
</tr>
<tr class="odd">
<td>2006-09-23 22:27:20 UTC</td>
<td>6</td>
<td>9</td>
<td>22</td>
<td>2006-09-23</td>
</tr>
<tr class="even">
<td>2006-09-23 22:31:03 UTC</td>
<td>6</td>
<td>9</td>
<td>22</td>
<td>2006-09-23</td>
</tr>
<tr class="odd">
<td>2006-10-03 18:18:09 UTC</td>
<td>2</td>
<td>10</td>
<td>18</td>
<td>2006-10-03</td>
</tr>
<tr class="even">
<td>2006-10-03 18:19:32 UTC</td>
<td>2</td>
<td>10</td>
<td>18</td>
<td>2006-10-03</td>
</tr>
<tr class="odd">
<td>2006-10-10 18:48:26 UTC</td>
<td>2</td>
<td>10</td>
<td>18</td>
<td>2006-10-10</td>
</tr>
<tr class="even">
<td>2006-10-11 05:29:32 UTC</td>
<td>3</td>
<td>10</td>
<td>5</td>
<td>2006-10-11</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Weekday and month names
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If you need weekday or month names as strings, you can create a mapping from the numeric values. For example, you could use <code>pl.when()</code> chains or join with a lookup table. The numeric representation is often more convenient for analysis and avoids locale-dependent issues.</p>
</div>
</div>
</div>
<p>Another regional issue that arises when working with dates and times are time zones. While seemingly not too difficult a concept, getting time zones to work correctly with complex datasets can be incredibly complicated. A wide range of programming bugs have been attributed to all sorts of edge-cases surrounding the processing of time zones.</p>
<p>All times stored in Polars can be timezone-aware or timezone-naive. By default, times are stored as timezone-naive (no timezone information). The data can be localized to a specific timezone using the <code>.dt.replace_time_zone()</code> method, and converted between time zones using <code>.dt.convert_time_zone()</code>. All of the times recorded in the dataset <code>page_revisions</code> are given in UTC. This is not surprising; most technical sources with a global focus will use this convention.</p>
<p>We can convert between time zones using Polars datetime methods. Since we parsed our data with <code>time_zone="UTC"</code>, the datetime column is already timezone-aware. We can convert to another timezone using <code>.dt.convert_time_zone()</code>. Let’s convert our UTC times to New York time:</p>
<div id="a229805e" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">10</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        datetime_utc <span class="op">=</span> c.datetime,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        datetime_nyc <span class="op">=</span> c.datetime.dt.convert_time_zone(<span class="st">"America/New_York"</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        hour_utc <span class="op">=</span> c.datetime_utc.dt.hour(),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        hour_nyc <span class="op">=</span> c.datetime_nyc.dt.hour()</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    .select(c.datetime_utc, c.datetime_nyc, c.hour_utc, c.hour_nyc)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">datetime_utc</th>
<th data-quarto-table-cell-role="th">datetime_nyc</th>
<th data-quarto-table-cell-role="th">hour_utc</th>
<th data-quarto-table-cell-role="th">hour_nyc</th>
</tr>
<tr class="even">
<th>datetime[μs, UTC]</th>
<th>datetime[μs, America/New_York]</th>
<th>i8</th>
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2006-07-06 23:24:54 UTC</td>
<td>2006-07-06 19:24:54 EDT</td>
<td>23</td>
<td>19</td>
</tr>
<tr class="even">
<td>2006-07-24 18:39:08 UTC</td>
<td>2006-07-24 14:39:08 EDT</td>
<td>18</td>
<td>14</td>
</tr>
<tr class="odd">
<td>2006-09-10 13:36:44 UTC</td>
<td>2006-09-10 09:36:44 EDT</td>
<td>13</td>
<td>9</td>
</tr>
<tr class="even">
<td>2006-09-18 04:59:53 UTC</td>
<td>2006-09-18 00:59:53 EDT</td>
<td>4</td>
<td>0</td>
</tr>
<tr class="odd">
<td>2006-09-23 22:27:20 UTC</td>
<td>2006-09-23 18:27:20 EDT</td>
<td>22</td>
<td>18</td>
</tr>
<tr class="even">
<td>2006-09-23 22:31:03 UTC</td>
<td>2006-09-23 18:31:03 EDT</td>
<td>22</td>
<td>18</td>
</tr>
<tr class="odd">
<td>2006-10-03 18:18:09 UTC</td>
<td>2006-10-03 14:18:09 EDT</td>
<td>18</td>
<td>14</td>
</tr>
<tr class="even">
<td>2006-10-03 18:19:32 UTC</td>
<td>2006-10-03 14:19:32 EDT</td>
<td>18</td>
<td>14</td>
</tr>
<tr class="odd">
<td>2006-10-10 18:48:26 UTC</td>
<td>2006-10-10 14:48:26 EDT</td>
<td>18</td>
<td>14</td>
</tr>
<tr class="even">
<td>2006-10-11 05:29:32 UTC</td>
<td>2006-10-11 01:29:32 EDT</td>
<td>5</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can use the timezone information to display data in a useful way to a local audience. For example, the code below displays the frequency of updates as a function of the hour of the day in New York City:</p>
<div id="33b3fed6" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>hourly_edits <span class="op">=</span> (</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        datetime_nyc <span class="op">=</span> c.datetime.dt.convert_time_zone(<span class="st">"America/New_York"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        hour_nyc <span class="op">=</span> c.datetime_nyc.dt.hour()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    .group_by(c.hour_nyc)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> pl.<span class="bu">len</span>()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    .sort(c.hour_nyc)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    hourly_edits</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    .pipe(ggplot, aes(<span class="st">"hour_nyc"</span>, <span class="st">"count"</span>))</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_col()</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Wikipedia Edits by Hour (New York Time)"</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"Hour of Day"</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Number of Edits"</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>
<figure class="figure">
<p><a href="17_temporal_data_files/figure-html/cell-18-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="17_temporal_data_files/figure-html/cell-18-output-1.png" width="672" height="480" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>While certainly many editors are living in other English-speaking cities (London, Los Angeles, or Mumbai), it is generally easier for people to do the mental math for what times correspond relative to their own time zone than relative to UTC.</p>
</section>
<section id="truncating-dates-data" class="level2" data-number="17.7">
<h2 data-number="17.7" class="anchored" data-anchor-id="truncating-dates-data"><span class="header-section-number">17.7</span> Truncating Dates Data</h2>
<p>We have shown above how to create date and datetime objects using Polars functions. Also, we have seen how to extract the components from date and datetime objects with the <code>.dt</code> namespace. There are a variety of other functions that help us create and manipulate these temporal objects. While we will not give an entire list of all the available functions in Polars datetime functionality, let’s look at a few of the most useful and representative examples for converting between different ways of representing information about time.</p>
<p>The <code>page_revisions</code> dataset has revisions recorded with the precision of a second. This is likely overly granular for many applications; it might be better to have the data in a format that is only at the level of an hour, for example. We can truncate any date or datetime object by using the <code>.dt.truncate()</code> method along with a specific duration. Setting the duration to “1h” (one hour), for example, will remove all of the minutes and seconds from the time:</p>
<div id="72bad4c6" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">10</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        datetime_hour <span class="op">=</span> c.datetime.dt.truncate(<span class="st">"1h"</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        datetime_day <span class="op">=</span> c.datetime.dt.truncate(<span class="st">"1d"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    .select(c.datetime, c.datetime_hour, c.datetime_day)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">datetime_hour</th>
<th data-quarto-table-cell-role="th">datetime_day</th>
</tr>
<tr class="even">
<th>datetime[μs, UTC]</th>
<th>datetime[μs, UTC]</th>
<th>datetime[μs, UTC]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2006-07-06 23:24:54 UTC</td>
<td>2006-07-06 23:00:00 UTC</td>
<td>2006-07-06 00:00:00 UTC</td>
</tr>
<tr class="even">
<td>2006-07-24 18:39:08 UTC</td>
<td>2006-07-24 18:00:00 UTC</td>
<td>2006-07-24 00:00:00 UTC</td>
</tr>
<tr class="odd">
<td>2006-09-10 13:36:44 UTC</td>
<td>2006-09-10 13:00:00 UTC</td>
<td>2006-09-10 00:00:00 UTC</td>
</tr>
<tr class="even">
<td>2006-09-18 04:59:53 UTC</td>
<td>2006-09-18 04:00:00 UTC</td>
<td>2006-09-18 00:00:00 UTC</td>
</tr>
<tr class="odd">
<td>2006-09-23 22:27:20 UTC</td>
<td>2006-09-23 22:00:00 UTC</td>
<td>2006-09-23 00:00:00 UTC</td>
</tr>
<tr class="even">
<td>2006-09-23 22:31:03 UTC</td>
<td>2006-09-23 22:00:00 UTC</td>
<td>2006-09-23 00:00:00 UTC</td>
</tr>
<tr class="odd">
<td>2006-10-03 18:18:09 UTC</td>
<td>2006-10-03 18:00:00 UTC</td>
<td>2006-10-03 00:00:00 UTC</td>
</tr>
<tr class="even">
<td>2006-10-03 18:19:32 UTC</td>
<td>2006-10-03 18:00:00 UTC</td>
<td>2006-10-03 00:00:00 UTC</td>
</tr>
<tr class="odd">
<td>2006-10-10 18:48:26 UTC</td>
<td>2006-10-10 18:00:00 UTC</td>
<td>2006-10-10 00:00:00 UTC</td>
</tr>
<tr class="even">
<td>2006-10-11 05:29:32 UTC</td>
<td>2006-10-11 05:00:00 UTC</td>
<td>2006-10-11 00:00:00 UTC</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The benefit of using the <code>.dt.truncate()</code> method is that we could then group, join, or summarize the data in a way that treats each value of <code>datetime</code> the same as long as they occur during the same hour. There is also a <code>.dt.round()</code> method for rounding the datetime object to the nearest desired unit. In the special case in which we want to extract just the date part of a datetime, we can use the <code>.dt.date()</code> method. The code below illustrates this process, as well as showing how reducing the temporal granularity can be a useful first step before grouping and summarizing:</p>
<div id="cabf38b3" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        date <span class="op">=</span> c.datetime.dt.date()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    .group_by(c.date)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> pl.<span class="bu">len</span>()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    .sort(c.date, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4_831, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="even">
<th>date</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2023-09-30</td>
<td>10</td>
</tr>
<tr class="even">
<td>2023-09-29</td>
<td>11</td>
</tr>
<tr class="odd">
<td>2023-09-28</td>
<td>9</td>
</tr>
<tr class="even">
<td>2023-09-27</td>
<td>14</td>
</tr>
<tr class="odd">
<td>2023-09-26</td>
<td>12</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2003-02-01</td>
<td>1</td>
</tr>
<tr class="even">
<td>2003-01-29</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2003-01-14</td>
<td>1</td>
</tr>
<tr class="even">
<td>2003-01-04</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2002-10-26</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Above, we effectively remove the time component of the datetime object and treat the variable as having only a date element. Occasionally, we might want to do the opposite: considering only the time component of a datetime object without worrying about the specific date. For example, we might want to summarize the number of edits that are made based on the time of the day. We can do this by extracting the hour component:</p>
<div id="f8c54595" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        hour <span class="op">=</span> c.datetime.dt.hour()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    .group_by(c.hour)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> pl.<span class="bu">len</span>()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    .sort(c.hour)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (24, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="even">
<th>i8</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1316</td>
</tr>
<tr class="even">
<td>1</td>
<td>1229</td>
</tr>
<tr class="odd">
<td>2</td>
<td>1149</td>
</tr>
<tr class="even">
<td>3</td>
<td>1010</td>
</tr>
<tr class="odd">
<td>4</td>
<td>982</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>19</td>
<td>1837</td>
</tr>
<tr class="even">
<td>20</td>
<td>1838</td>
</tr>
<tr class="odd">
<td>21</td>
<td>1797</td>
</tr>
<tr class="even">
<td>22</td>
<td>1675</td>
</tr>
<tr class="odd">
<td>23</td>
<td>1349</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This creates a variable that stores the hour without any date information, which is useful for analyzing patterns that repeat daily.</p>
</section>
<section id="window-functions" class="level2" data-number="17.8">
<h2 data-number="17.8" class="anchored" data-anchor-id="window-functions"><span class="header-section-number">17.8</span> Window Functions</h2>
<p>At the start of this chapter, we considered time series to be a sequence of events without too much focus on the specific dates and times. This viewpoint can be a useful construct when we want to look at changes over time. For example, we have the overall size of each Wikipedia page after an edit. A measurement that would be useful is the difference in page size made by an edit. To add a variable to a dataset, we usually use the <code>.with_columns()</code> method, and that will again work here. However, in this case we need to reference values that come before or after a certain value. This requires the use of window functions.</p>
<p>A <em>window function</em> transforms a variable in a dataset into a new variable with the same length in a way that takes into account the entire ordering of the data. Two examples of window functions that are useful when working with time series data are <code>.shift()</code> with positive and negative values, which give access to rows preceding or following a row, respectively. Let’s apply this to our dataset of page revisions to get the previous and next values of the page size variable.</p>
<div id="cfb0874c" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        size_last <span class="op">=</span> c.size.shift(<span class="dv">1</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        size_next <span class="op">=</span> c.size.shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    .select(c.doc_id, c.datetime, c.size, c.size_last, c.size_next)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (35_470, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">size_last</th>
<th data-quarto-table-cell-role="th">size_next</th>
</tr>
<tr class="even">
<th>str</th>
<th>datetime[μs, UTC]</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Marie de France"</td>
<td>2006-07-06 23:24:54 UTC</td>
<td>3061</td>
<td>null</td>
<td>3085</td>
</tr>
<tr class="even">
<td>"Marie de France"</td>
<td>2006-07-24 18:39:08 UTC</td>
<td>3085</td>
<td>3061</td>
<td>3085</td>
</tr>
<tr class="odd">
<td>"Marie de France"</td>
<td>2006-09-10 13:36:44 UTC</td>
<td>3085</td>
<td>3085</td>
<td>3105</td>
</tr>
<tr class="even">
<td>"Marie de France"</td>
<td>2006-09-18 04:59:53 UTC</td>
<td>3105</td>
<td>3085</td>
<td>3104</td>
</tr>
<tr class="odd">
<td>"Marie de France"</td>
<td>2006-09-23 22:27:20 UTC</td>
<td>3104</td>
<td>3105</td>
<td>3132</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Seamus Heaney"</td>
<td>2023-09-21 04:51:45 UTC</td>
<td>85491</td>
<td>85341</td>
<td>85493</td>
</tr>
<tr class="even">
<td>"Seamus Heaney"</td>
<td>2023-09-24 12:10:49 UTC</td>
<td>85493</td>
<td>85491</td>
<td>85482</td>
</tr>
<tr class="odd">
<td>"Seamus Heaney"</td>
<td>2023-09-25 16:06:01 UTC</td>
<td>85482</td>
<td>85493</td>
<td>85493</td>
</tr>
<tr class="even">
<td>"Seamus Heaney"</td>
<td>2023-09-25 16:06:11 UTC</td>
<td>85493</td>
<td>85482</td>
<td>85493</td>
</tr>
<tr class="odd">
<td>"Seamus Heaney"</td>
<td>2023-09-27 02:39:46 UTC</td>
<td>85493</td>
<td>85493</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Notice that the first value of <code>size_last</code> is missing because there is no <em>last</em> value for the first item in our data. Similarly, the variable <code>size_next</code> will have a missing value at the end of the dataset. As written above, the code incorrectly crosses the time points at the boundary of each page. That is, for the first row of the second page (Geoffrey Chaucer) it thinks that the size of the last page is the size of the final page of the Marie de France record. To fix this, we can use the <code>.over()</code> method to apply the window function within groups. Window functions respect the grouping of the data:</p>
<div id="72a5a1e2" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    .sort(c.doc_id, c.datetime)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        size_last <span class="op">=</span> c.size.shift(<span class="dv">1</span>).over(c.doc_id),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        size_next <span class="op">=</span> c.size.shift(<span class="op">-</span><span class="dv">1</span>).over(c.doc_id)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    .select(c.doc_id, c.datetime, c.size, c.size_last, c.size_next)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">slice</span>(<span class="dv">495</span>, <span class="dv">10</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">size_last</th>
<th data-quarto-table-cell-role="th">size_next</th>
</tr>
<tr class="even">
<th>str</th>
<th>datetime[μs, UTC]</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2023-08-05 20:59:54 UTC</td>
<td>44019</td>
<td>43990</td>
<td>44038</td>
</tr>
<tr class="even">
<td>"A. A. Milne"</td>
<td>2023-08-18 09:26:21 UTC</td>
<td>44038</td>
<td>44019</td>
<td>44044</td>
</tr>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2023-08-21 22:05:31 UTC</td>
<td>44044</td>
<td>44038</td>
<td>44045</td>
</tr>
<tr class="even">
<td>"A. A. Milne"</td>
<td>2023-08-21 22:07:46 UTC</td>
<td>44045</td>
<td>44044</td>
<td>44077</td>
</tr>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2023-08-31 20:41:54 UTC</td>
<td>44077</td>
<td>44045</td>
<td>null</td>
</tr>
<tr class="even">
<td>"Alexander Pope"</td>
<td>2016-04-17 04:03:45 UTC</td>
<td>31345</td>
<td>null</td>
<td>31531</td>
</tr>
<tr class="odd">
<td>"Alexander Pope"</td>
<td>2016-05-05 22:17:54 UTC</td>
<td>31531</td>
<td>31345</td>
<td>31532</td>
</tr>
<tr class="even">
<td>"Alexander Pope"</td>
<td>2016-05-05 22:24:29 UTC</td>
<td>31532</td>
<td>31531</td>
<td>31585</td>
</tr>
<tr class="odd">
<td>"Alexander Pope"</td>
<td>2016-05-07 19:05:49 UTC</td>
<td>31585</td>
<td>31532</td>
<td>31614</td>
</tr>
<tr class="even">
<td>"Alexander Pope"</td>
<td>2016-05-09 17:22:21 UTC</td>
<td>31614</td>
<td>31585</td>
<td>31585</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Notice that now, correctly, the dataset has a missing <code>size_next</code> for the final Marie de France record and a missing <code>size_last</code> for the first Geoffrey Chaucer record. Now, let’s use this to compute the change in the page sizes for each of the revisions:</p>
<div id="33cd5118" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    .sort(c.doc_id, c.datetime)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        size_diff <span class="op">=</span> c.size <span class="op">-</span> c.size.shift(<span class="dv">1</span>).over(c.doc_id)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    .select(c.doc_id, c.datetime, c.size, c.size_diff)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (35_470, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">size_diff</th>
</tr>
<tr class="even">
<th>str</th>
<th>datetime[μs, UTC]</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2015-09-04 16:30:26 UTC</td>
<td>30702</td>
<td>null</td>
</tr>
<tr class="even">
<td>"A. A. Milne"</td>
<td>2015-09-22 14:51:08 UTC</td>
<td>30400</td>
<td>-302</td>
</tr>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2015-11-07 10:23:31 UTC</td>
<td>30389</td>
<td>-11</td>
</tr>
<tr class="even">
<td>"A. A. Milne"</td>
<td>2015-11-08 00:48:23 UTC</td>
<td>30397</td>
<td>8</td>
</tr>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2015-11-16 03:12:19 UTC</td>
<td>30427</td>
<td>30</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"William Wordsworth"</td>
<td>2023-09-25 11:19:40 UTC</td>
<td>41466</td>
<td>0</td>
</tr>
<tr class="even">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:10:27 UTC</td>
<td>41464</td>
<td>-2</td>
</tr>
<tr class="odd">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:11:44 UTC</td>
<td>41466</td>
<td>2</td>
</tr>
<tr class="even">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:13:48 UTC</td>
<td>41467</td>
<td>1</td>
</tr>
<tr class="odd">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:18:10 UTC</td>
<td>41466</td>
<td>-1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In the above output, we can see the changes in page sizes. If we wanted to find reversions in the dataset, we could apply the <code>.shift()</code> function several times. As an alternative, we can also give a parameter to <code>.shift()</code> to indicate that we want to go back (or forward) more than one row. Let’s put this together to indicate which commits seem to be a reversion (the page size exactly matches the page size from two commits prior) as well as the overall size of the reversion:</p>
<div id="bbf8913f" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    .sort(c.doc_id, c.datetime)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        size_diff <span class="op">=</span> c.size <span class="op">-</span> c.size.shift(<span class="dv">1</span>).over(c.doc_id),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        size_two_back <span class="op">=</span> c.size.shift(<span class="dv">2</span>).over(c.doc_id),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        is_reversion <span class="op">=</span> c.size <span class="op">==</span> c.size.shift(<span class="dv">2</span>).over(c.doc_id)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(c.is_reversion)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    .select(c.doc_id, c.datetime, c.size_diff, c.is_reversion)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4_927, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">size_diff</th>
<th data-quarto-table-cell-role="th">is_reversion</th>
</tr>
<tr class="even">
<th>str</th>
<th>datetime[μs, UTC]</th>
<th>i64</th>
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2015-12-17 18:13:11 UTC</td>
<td>-6</td>
<td>true</td>
</tr>
<tr class="even">
<td>"A. A. Milne"</td>
<td>2016-01-07 18:55:26 UTC</td>
<td>30407</td>
<td>true</td>
</tr>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2016-04-14 17:38:45 UTC</td>
<td>36</td>
<td>true</td>
</tr>
<tr class="even">
<td>"A. A. Milne"</td>
<td>2016-04-17 15:06:58 UTC</td>
<td>-77</td>
<td>true</td>
</tr>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2016-04-27 20:04:19 UTC</td>
<td>-1</td>
<td>true</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"William Wordsworth"</td>
<td>2023-09-18 06:35:43 UTC</td>
<td>-1</td>
<td>true</td>
</tr>
<tr class="even">
<td>"William Wordsworth"</td>
<td>2023-09-24 14:54:33 UTC</td>
<td>8</td>
<td>true</td>
</tr>
<tr class="odd">
<td>"William Wordsworth"</td>
<td>2023-09-25 11:19:40 UTC</td>
<td>0</td>
<td>true</td>
</tr>
<tr class="even">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:11:44 UTC</td>
<td>2</td>
<td>true</td>
</tr>
<tr class="odd">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:18:10 UTC</td>
<td>-1</td>
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>These reversions can be studied to see the nature of the Wikipedia editing process. For example, how long do these reversions tend to take? Are certain pages more likely to undergo reversions? Do these take place during a certain time of the day? These are all questions that we should now be able to address using this dataset and the tools described above.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Additional window functions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Polars provides many other window functions beyond <code>.shift()</code>. Common examples include <code>.cum_sum()</code> for cumulative sums, <code>.rolling_mean()</code> for moving averages, <code>.rank()</code> for ranking values, and <code>.diff()</code> which computes the difference between consecutive values (equivalent to <code>x - x.shift(1)</code>). All of these can be combined with <code>.over()</code> to apply within groups.</p>
</div>
</div>
</div>
</section>
<section id="range-joins" class="level2" data-number="17.9">
<h2 data-number="17.9" class="anchored" data-anchor-id="range-joins"><span class="header-section-number">17.9</span> Range Joins</h2>
<p>We will finish this chapter by looking at <em>range joins</em>, which allow for combining datasets based on inequalities between keys contained in two different datasets. Range joins are functionality that can greatly simplify some operations that arise when working with temporal data. Recall that all of the join functions that we saw in <a href="04_combine.html" class="quarto-xref"><span>Chapter 4</span></a> work by finding a correspondence where keys from one dataset equal the values of keys in another dataset. In some cases it happens that we want to join two tables on inequalities rather than exact values.</p>
<p>Take, for example, the metadata table for the 75 authors in our Wikipedia collection. Recall that this dataset contains the years that each author was born and the years each author died. What if we wanted to make a dataset by joining the metadata to itself, matching each author with other authors that would have been alive in overlapping years? We can do this using Polars’ <code>.join_where()</code> method:</p>
<div id="dd3a8911" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    meta</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    .join_where(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        meta,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        (c.born <span class="op">&lt;=</span> c.born_right) <span class="op">&amp;</span> (c.died <span class="op">&gt;</span> c.born_right) <span class="op">&amp;</span> (c.doc_id <span class="op">!=</span> c.doc_id_right)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    .select(c.doc_id, c.doc_id_right, c.born, c.died, c.born_right, c.died_right)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (693, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">doc_id_right</th>
<th data-quarto-table-cell-role="th">born</th>
<th data-quarto-table-cell-role="th">died</th>
<th data-quarto-table-cell-role="th">born_right</th>
<th data-quarto-table-cell-role="th">died_right</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"William Langland"</td>
<td>"Geoffrey Chaucer"</td>
<td>1332</td>
<td>1386</td>
<td>1343</td>
<td>1400</td>
</tr>
<tr class="even">
<td>"William Langland"</td>
<td>"Margery Kempe"</td>
<td>1332</td>
<td>1386</td>
<td>1373</td>
<td>1438</td>
</tr>
<tr class="odd">
<td>"Geoffrey Chaucer"</td>
<td>"Margery Kempe"</td>
<td>1343</td>
<td>1400</td>
<td>1373</td>
<td>1438</td>
</tr>
<tr class="even">
<td>"John Gower"</td>
<td>"William Langland"</td>
<td>1330</td>
<td>1408</td>
<td>1332</td>
<td>1386</td>
</tr>
<tr class="odd">
<td>"John Gower"</td>
<td>"Geoffrey Chaucer"</td>
<td>1330</td>
<td>1408</td>
<td>1343</td>
<td>1400</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Edward Upward"</td>
<td>"Daphne du Maurier"</td>
<td>1903</td>
<td>2009</td>
<td>1907</td>
<td>1989</td>
</tr>
<tr class="even">
<td>"Edward Upward"</td>
<td>"W. H. Auden"</td>
<td>1903</td>
<td>2009</td>
<td>1907</td>
<td>1973</td>
</tr>
<tr class="odd">
<td>"Edward Upward"</td>
<td>"Louis MacNeice"</td>
<td>1903</td>
<td>2009</td>
<td>1907</td>
<td>1963</td>
</tr>
<tr class="even">
<td>"Edward Upward"</td>
<td>"Stephen Spender"</td>
<td>1903</td>
<td>2009</td>
<td>1909</td>
<td>1995</td>
</tr>
<tr class="odd">
<td>"Edward Upward"</td>
<td>"Seamus Heaney"</td>
<td>1903</td>
<td>2009</td>
<td>1939</td>
<td>1939</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The <code>.join_where()</code> method takes one or more expressions to specify which pairs of rows to keep in the joined dataset. To refer to columns in the second (right) dataset that share the same name, use the <code>_right</code> suffix. In the example above, we find all pairs where the first author’s lifespan overlaps with the second author’s birth, excluding self-matches.</p>
<p>The resulting dataset would make an interesting type of network, showing temporal overlap of authors in the dataset. We will investigate this in the following chapter.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Performance of conditional joins
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The <code>.join_where()</code> method can be slow because it needs to check every combination of rows in the two datasets. For large datasets, consider whether you can use <code>.join_asof()</code> instead, which is optimized for nearest-value matching and requires the data to be sorted. The <code>.join_asof()</code> method is particularly useful when you want to match each row to the nearest (or nearest preceding/following) value in another dataset.</p>
</div>
</div>
</div>
</section>
<section id="temporal-durations" class="level2" data-number="17.10">
<h2 data-number="17.10" class="anchored" data-anchor-id="temporal-durations"><span class="header-section-number">17.10</span> Temporal Durations</h2>
<p>Sometimes we want to work not with specific dates or times, but with durations—the amount of time between two events. Polars represents durations with the <code>Duration</code> data type. We can compute durations by subtracting one datetime from another, or by using the <code>pl.duration()</code> function to create specific intervals.</p>
<div id="9b3e7fcf" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    .sort(c.doc_id, c.datetime)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        time_since_last <span class="op">=</span> c.datetime <span class="op">-</span> c.datetime.shift(<span class="dv">1</span>).over(c.doc_id)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    .select(c.doc_id, c.datetime, c.time_since_last)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    .drop_nulls()</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (35_395, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">time_since_last</th>
</tr>
<tr class="even">
<th>str</th>
<th>datetime[μs, UTC]</th>
<th>duration[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2015-09-22 14:51:08 UTC</td>
<td>17d 22h 20m 42s</td>
</tr>
<tr class="even">
<td>"A. A. Milne"</td>
<td>2015-11-07 10:23:31 UTC</td>
<td>45d 19h 32m 23s</td>
</tr>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2015-11-08 00:48:23 UTC</td>
<td>14h 24m 52s</td>
</tr>
<tr class="even">
<td>"A. A. Milne"</td>
<td>2015-11-16 03:12:19 UTC</td>
<td>8d 2h 23m 56s</td>
</tr>
<tr class="odd">
<td>"A. A. Milne"</td>
<td>2015-11-17 07:52:16 UTC</td>
<td>1d 4h 39m 57s</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"William Wordsworth"</td>
<td>2023-09-25 11:19:40 UTC</td>
<td>1h 17m</td>
</tr>
<tr class="even">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:10:27 UTC</td>
<td>2d 3h 50m 47s</td>
</tr>
<tr class="odd">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:11:44 UTC</td>
<td>1m 17s</td>
</tr>
<tr class="even">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:13:48 UTC</td>
<td>2m 4s</td>
</tr>
<tr class="odd">
<td>"William Wordsworth"</td>
<td>2023-09-27 15:18:10 UTC</td>
<td>4m 22s</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The resulting duration can be converted to various units using methods like <code>.dt.total_days()</code>, <code>.dt.total_hours()</code>, <code>.dt.total_minutes()</code>, or <code>.dt.total_seconds()</code>. This is useful for analyzing how frequently events occur or how long processes take.</p>
<div id="6dc459b2" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    page_revisions</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    .sort(c.doc_id, c.datetime)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        time_since_last <span class="op">=</span> c.datetime <span class="op">-</span> c.datetime.shift(<span class="dv">1</span>).over(c.doc_id)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        days_since_last <span class="op">=</span> c.time_since_last.dt.total_days()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    .select(c.doc_id, c.datetime, c.days_since_last)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    .drop_nulls()</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    .group_by(c.doc_id)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        avg_days_between_edits <span class="op">=</span> c.days_since_last.mean()</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    .sort(c.avg_days_between_edits)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (75, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">doc_id</th>
<th data-quarto-table-cell-role="th">avg_days_between_edits</th>
</tr>
<tr class="even">
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"George Orwell"</td>
<td>1.138277</td>
</tr>
<tr class="even">
<td>"James Joyce"</td>
<td>1.224449</td>
</tr>
<tr class="odd">
<td>"Oscar Wilde"</td>
<td>1.58517</td>
</tr>
<tr class="even">
<td>"Thomas More"</td>
<td>1.791583</td>
</tr>
<tr class="odd">
<td>"Percy Bysshe Shelley"</td>
<td>1.815631</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"John Gower"</td>
<td>24.467105</td>
</tr>
<tr class="even">
<td>"Edward Upward"</td>
<td>27.0</td>
</tr>
<tr class="odd">
<td>"Katherine Philipps"</td>
<td>31.182692</td>
</tr>
<tr class="even">
<td>"Rex Warner"</td>
<td>39.488506</td>
</tr>
<tr class="odd">
<td>"Charlotte Smith"</td>
<td>168.222222</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This shows us which Wikipedia pages are edited most frequently (smallest average days between edits) and which are edited less often.</p>
</section>
<section id="summary" class="level2" data-number="17.11">
<h2 data-number="17.11" class="anchored" data-anchor-id="summary"><span class="header-section-number">17.11</span> Summary</h2>
<p>In this chapter, we explored techniques for working with temporal data in Polars. We learned how to create date and datetime objects from their components, extract useful information from them, and visualize temporal patterns. We saw how to work with time zones and how to truncate temporal data to different levels of granularity. Window functions allowed us to compare values across time within groups, and range joins provided a way to combine datasets based on temporal overlap. These tools are essential for any analysis involving time-based data.</p>
</section>
<section id="references" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="references">References</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/taylor-arnold\.github\.io\/fds-py");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./16_spatial_data.html" class="pagination-link" aria-label="Spatial Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./18_network_data.html" class="pagination-link" aria-label="Network Data">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Network Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Taylor Arnold</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>A <a href="https://distantviewing.org/">Distant Viewing Lab</a> project</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>